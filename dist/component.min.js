!function(e,t){"function"==typeof define&&define.amd?define(["Handlebars","morphdom","superagent","underscore"],t):"object"==typeof exports?module.exports=t(require("Handlebars"),require("morphdom"),require("superagent"),require("underscore")):(e.cargo=e.cargo||{},e.cargo.Component=t(e.Handlebars,e.morphdom,e.superagent,e.underscore))}(this,function(e,t,r,n){var o=function(e){"use strict";if(!Promise)throw new Error("Promise API is required.");if(!t)throw new Error("morphdom is required. (https://github.com/patrick-steele-idem/morphdom)");if(!r)throw new Error("superagent is required. (https://github.com/visionmedia/superagent)");if(!n)throw new Error("underscore is required. (https://github.com/jashkenas/underscore)");var o=window.$;e=e||{};var a=e.template||function(e){return"<pre>"+JSON.stringify(e,void 0," ")+"</pre>"},c=e.attach||function(){},s=e.update||function(){},u=e.detach||function(){};return this.attach=function(e){if(!e)throw new Error("Need a jquery selector as first argument to attach().");var t=o(e),r={};if(!t||0==t.length)throw new Error("Selector "+e+" does not select any actual DOM nodes.");return t.each(function(t,i){var a=o(i),c=a.attr("x-cargo-id");if(c)throw new Error("Node "+i.toString()+" selected by "+e+" has already been attached to a component.");var s=n.uniqueId();a.attr("x-cargo-id",s),r[s]=i}),new i(e,r,a,c,s,u)},this};o.prototype.constructor=o,o.load=function(t,n){return n=n||e,new Promise(function(e,i){r.get(t).end(function(r,a){if(r)return void i(new Error("Unable to load template from '"+t+"': "+r));var c;try{var s=new DOMParser,u=s.parseFromString(a.text,"text/html"),d=$(u).find("template").first();if(!d||!d.length)return void i(new Error("Template '"+t+"' does not contain a <template> element in body."));d=d.html().trim(),c=n.compile(d)}catch(h){return void i(new Error("Unable to compile rendering function from template '"+t+"': "+h))}var l={};l.template=c;for(var f=["attach","update","detach"],p=0;p<f.length;p++){var m=f[p];try{var g=$(u).find("script."+m).first();if(g.length>0){var v=g.text();l[m]=new Function("node",v)}}catch(h){return void i(new Error("Unable to install '"+m+"' function from template '"+t+"': "+h))}}e(new o(l))})})},o.compile=function(t,r){r=r||{};var o,i=r.handlebars||e,a=t.getElementsByTagName("template");if(a&&a.length){a=a[0];var c=a.innerHTML.trim();o=i.precompile(c),o="Handlebars.template("+o+")"}else o="undefined";var s=["attach","update","detach"],u={};return n.each(s,function(e){var r=t.getElementsByTagName("script");u[e]=n.reduce(r,function(t,r){if("undefined"!==t)return t;if(r.hasAttribute("class")){var o=r.getAttribute("class");if(n.contains(o.split(/\s+/),e)){var i=r.innerHTML.trim();return"function(node) { "+i+"}"}}return t},"undefined")}),'{ "template":'+o+', "attach":'+u.attach+',"update":'+u.update+',"detach":'+u.detach+"}"};var i=function(e,r,o,i,a,c){var s=$(),u=!0;this.detach=function(){n.each(r,function(e,t){e.removeAttribute("x-cargo-id"),s&&s.length&&s.each(function(){if(this.getAttribute("x-cargo-id")===t){try{c&&c(this)}catch(r){}$(this).replaceWith(e)}})}),r={},s=$(),u=!0},this.render=function(c){if(void 0===c)return Promise.resolve(c);if(c instanceof Error)return Promise.reject(c);if(!e||!n.keys(r).length)return Promise.resolve(c);c.toJS&&"function"==typeof c.toJS&&(c=c.toJS());var d=o(c);return d?(u?(u=!1,n.each(r,function(t,r){var n=$.parseHTML(d);if(n&&n.length){var o=n[0],c=$(t);try{var u=c.prop("id");u&&(o.id=u),o.setAttribute("x-cargo-id",r),c.replaceWith(o),i.call(this,o),s=s.add(o)}catch(h){console.log("Error while calling attach() on component with selector: "+e+": "+h)}try{a.call(this,o)}catch(h){console.log("Error while calling update() on component with selector: "+e+": "+h)}}},this)):s.each(function(){var r=this.id,n=this.getAttribute("x-cargo-id");t(this,d),this.id=r,this.setAttribute("x-cargo-id",n);try{a.call(this)}catch(o){console.log("Error while calling update() on component with selector: "+e+": "+o)}}),Promise.resolve(c)):Promise.resolve(c)}};return i.prototype.constructor=i,o.Renderer=i,o});