!function(r,e){"function"==typeof define&&define.amd?define(["cargo.Model","cargo.Translation","morphdom","Handlebars","superagent"],e):"object"==typeof exports?module.exports=e(require("cargo.Model"),require("cargo.Translation"),require("morphdom"),require("Handlebars"),require("superagent")):(r.cargo=r.cargo||{},r.cargo.Component=e(r.cargo.Model,r.cargo.Translation,r.morphdom,r.Handlebars,r.superagent))}(this,function(r,e,t,o,n){var i=function(r){"use strict";if(!Promise)throw new Error("Promise API is required.");if(!t)throw new Error("morphdom is required. (https://github.com/patrick-steele-idem/morphdom)");if(!n)throw new Error("superagent is required. (https://github.com/visionmedia/superagent)");if(!_)throw new Error("underscore is required. (https://github.com/jashkenas/underscore)");var e=window.$;r=r||{};var o=r.template||function(r){return"<pre>"+JSON.stringify(r,void 0," ")+"</pre>"},i=r.attach||function(){},c=r.update||function(){},s=r.detach||function(){};return this.attach=function(r){if(!r)throw new Error("Need a jquery selector as first argument to attach().");var t=e(r),n={};if(!t||0==t.length)throw new Error("Selector "+r+" does not select any actual DOM nodes.");return t.each(function(t,o){var i=e(o),a=i.attr("x-cargo-id");if(a)throw new Error("Node "+o.toString()+" selected by "+r+" has already been attached to a component.");var c=_.uniqueId();i.attr("x-cargo-id",c),n[c]=o}),new a(r,n,o,i,c,s)},this};i.prototype.constructor=i,i.load=function(r,e){return e=e||o,new Promise(function(t,o){n.get(r).end(function(n,a){if(n)return void o(new Error("Unable to load template from '"+r+"': "+n));var c;try{var s=new DOMParser,h=s.parseFromString(a.text,"text/html"),l=$(h).find("template").first();if(!l||!l.length)return void o(new Error("Template '"+r+"' does not contain a <template> element in body."));l=l.html().trim(),c=e.compile(l)}catch(u){return void o(new Error("Unable to compile rendering function from template '"+r+"': "+u))}var d={};d.template=c;for(var f=["attach","update","detach"],m=0;m<f.length;m++){var p=f[m];try{var g=$(h).find("script."+p).first();if(g.length>0){var v=g.text();d[p]=new Function("node",v)}}catch(u){return void o(new Error("Unable to install '"+p+"' function from template '"+r+"': "+u))}}t(new i(d))})})};var a=function(e,o,n,i,a,c){var s=$(),h=!0;this.detach=function(){_.each(o,function(r,e){r.removeAttribute("x-cargo-id"),s&&s.length&&s.each(function(){if(this.getAttribute("x-cargo-id")===e){try{c&&c(this)}catch(t){}$(this).replaceWith(r)}})}),o={},s=$(),h=!0},this.render=function(c){if(c=r.state(c),void 0===c)return Promise.resolve(c);if(c instanceof Error)return Promise.reject(c);if(!e||!_.keys(o).length)return Promise.resolve(c);var l=n(c.toJS());return l?(h?(h=!1,_.each(o,function(r,t){var o=$.parseHTML(l);if(o&&o.length){var n=o[0],c=$(r);try{var h=c.prop("id");h&&(n.id=h),n.setAttribute("x-cargo-id",t),c.replaceWith(n),i.call(this,n),s=s.add(n)}catch(u){console.log("Error while calling attach() on component with selector: "+e+": "+u)}try{a.call(this,n)}catch(u){console.log("Error while calling update() on component with selector: "+e+": "+u)}}},this)):s.each(function(){var r=this.id,o=this.getAttribute("x-cargo-id");t(this,l),this.id=r,this.setAttribute("x-cargo-id",o);try{a.call(this)}catch(n){console.log("Error while calling update() on component with selector: "+e+": "+n)}}),Promise.resolve(c)):Promise.resolve(c)}};return a.prototype.constructor=a,i.Renderer=a,i});