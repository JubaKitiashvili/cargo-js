!function(r,o){"function"==typeof define&&define.amd?define(["cargo.Promise"],o):"object"==typeof exports?module.exports=o(require("cargo.Promise")):(r.cargo=r.cargo||{},r.cargo.Model=o(r.cargo.Promise))}(this,function(r){var o=function(o){"use strict";function n(r,o){var i;if(void 0!==o.length){i=[];for(var t=0;t<o.length;t++)"object"==typeof o[t]||"array"==typeof o[t]?i[t]=n(r[t],o[t]):i[t]=o[t];return i}i=r||{};var e;if(r&&"object"==typeof r)for(e in r)r.hasOwnProperty(e)&&(i[e]=r[e]);for(e in o)o.hasOwnProperty(e)&&("object"==typeof o[e]&&o[e]&&r[e]?i[e]=n(r[e],o[e]):i[e]=o[e]);return i}if(!r)throw new Error("cargo.Promise API is required.");var i=this,t=void 0,e=1,a={};i=function(o){var n=e++;if(o&&"function"==typeof o){a[n]={subscriber:o};var c=function(r){delete a[r]};return new r(function(r,n){if(void 0!==t&&!(t instanceof Error))try{var i=JSON.parse(JSON.stringify(t));o.call(void 0,i),r()}catch(e){console.log("Error in new subscriber: "+e),n()}}),c.bind(i,n)}};for(var c in o)if(o.hasOwnProperty(c)){var f=o[c];if("function"==typeof f){var s={state:function(r){return void 0===t?{}:void 0===r?n({},t):r instanceof Error?r:n(t,r)},model:i},u=function(){for(var o=this.actionCtx,n=this.actionFn,i=[],e=0;e<arguments.length;e++)i.push(arguments[e]);var c=function(r,e){if(t instanceof Error)return void e(t);var c;try{c=n.apply(o,i)}catch(f){e(f)}var s=c instanceof Error;if(void 0!==c){null===c&&(c={}),t=c;for(var u in a)if(a.hasOwnProperty(u)){var v=a[u].subscriber;try{var d=s?t:JSON.parse(JSON.stringify(t));v.call(void 0,d)}catch(f){console.log("Error in subscriber: "+f)}}s&&(a=[])}c instanceof Error?e(c):r(c)};return c=c.bind(this),new r(c)},v={actionCtx:s,actionFn:f};i[c]=u.bind(v)}}return i};return o});