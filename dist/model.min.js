!function(r,o){"function"==typeof define&&define.amd?define(["cargo.Promise"],o):"object"==typeof exports?module.exports=o(require("cargo.Promise")):(r.cargo=r.cargo||{},r.cargo.Model=o(r.cargo.Promise))}(this,function(r){var o=function(o){"use strict";function n(r,o){var t;if(void 0!==o.length){t=[];for(var i=0;i<o.length;i++)"object"==typeof o[i]||"array"==typeof o[i]?t[i]=n(r[i],o[i]):t[i]=o[i];return t}t=r||{};var e;if(r&&"object"==typeof r)for(e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);for(e in o)o.hasOwnProperty(e)&&("object"==typeof o[e]&&o[e]&&r[e]?t[e]=n(r[e],o[e]):t[e]=o[e]);return t}if(!r)throw new Error("datenwelt.Promise API is required.");var t=this,i=void 0,e=1,a={};t=function(r){var o=e++;if(r&&"function"==typeof r){a[o]={subscriber:r};var n=function(r){delete a[r]};return n.bind(t,o)}};for(var f in o)if(o.hasOwnProperty(f)){var c=o[f];if("function"==typeof c){var s={state:function(r){return void 0===i?{}:void 0===r?n({},i):r instanceof Error?r:n(i,r)},model:t},u=function(){for(var o=this.actionCtx,n=this.actionFn,t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var f=function(r,e){if(i instanceof Error)return void e(i);var f;try{f=n.apply(o,t)}catch(c){e(c)}var s=f instanceof Error;if(void 0!==f){null===f&&(f={}),i=f;for(var u in a)if(a.hasOwnProperty(u)){var v=a[u].subscriber;try{var d=s?i:JSON.parse(JSON.stringify(i));v.call(void 0,d)}catch(c){console.log("Error in subscriber: "+c)}}s&&(a=[])}f instanceof Error?e(f):r(f)};return f=f.bind(this),new r(f)},v={actionCtx:s,actionFn:c};t[f]=u.bind(v)}}return t};return o});