!function(r,o){"function"==typeof define&&define.amd?define(["cargo.Promise"],o):"object"==typeof exports?module.exports=o(require("cargo.Promise")):(r.cargo=r.cargo||{},r.cargo.Model=o(r.cargo.Promise))}(this,function(r){var o=function(o){"use strict";function n(r,o){var i;if(void 0!==o.length){i=[];for(var t=0;t<o.length;t++)"object"==typeof o[t]||"array"==typeof o[t]?i[t]=n(r[t],o[t]):i[t]=o[t];return i}i=r||{};var e;if(r&&"object"==typeof r)for(e in r)r.hasOwnProperty(e)&&(i[e]=r[e]);for(e in o)o.hasOwnProperty(e)&&("object"==typeof o[e]&&o[e]&&r[e]?i[e]=n(r[e],o[e]):i[e]=o[e]);return i}if(!r)throw new Error("cargo.Promise API is required.");var i=this,t=void 0,e=1,c={};i=function(o){var n=e++;if(o&&"function"==typeof o){c[n]={subscriber:o};var a=function(r){delete c[r]};return new r(function(r,n){if(void 0!==t&&!(t instanceof Error))try{var i=JSON.parse(JSON.stringify(t));o.call(void 0,i),r()}catch(e){console.log("Error in new subscriber: "+e),n()}}),a.bind(i,n)}};for(var a in o)if(o.hasOwnProperty(a)){var f=o[a];if("function"==typeof f){var s={state:function(r){return void 0===t?{}:void 0===r?n({},t):r instanceof Error?r:n(t,r)},model:i},u=function(){for(var o=this.actionCtx,n=this.actionFn,i=[],e=0;e<arguments.length;e++)i.push(arguments[e]);var a=function(r,e){if(t instanceof Error)return void e(t);var a;try{a=n.apply(o,i)}catch(f){e(f)}var s=a instanceof Error;if(void 0!==a){null===a&&(a={}),t=a;for(var u in c)if(c.hasOwnProperty(u)){var v=c[u].subscriber;try{var d=s?t:JSON.parse(JSON.stringify(t));v.call(void 0,d)}catch(f){console.log("Error in subscriber: "+f),console.trace(f)}}s&&(c=[])}a instanceof Error?e(a):r(a)};return a=a.bind(this),new r(a)},v={actionCtx:s,actionFn:f};i[a]=u.bind(v)}}return i};return o.subscribe=function(r,o){return r(o)},o});