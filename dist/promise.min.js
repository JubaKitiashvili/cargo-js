!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():(e.cargo=e.cargo||{},e.cargo.Promise=n())}(this,function(){"use strict";var e=function(n){var t=this,i="pending",o=void 0,r=[];t.state=function(){return{state:i,result:o}},t.resolve=function(e){setTimeout(function(){l(e)},0)},t.reject=function(e){setTimeout(function(){c("rejected",e),u()},0)};var f=function(e){var n=["state","then","reject","resolve"];if(!e)return!1;for(var t=0;t<n.length;t++){var i=n[t];if(!e[i]||"function"!=typeof e[i])return!1}return!0},c=function(e,n){"pending"!=e&&"fulfilled"!=e&&"rejected"!=e||"pending"==i&&"pending"!=e&&(i=e,o=n)},u=function(){if("pending"!=i)for(;r.length>0;){var e,n=r.shift(),t=n.promise2;if("fulfilled"===i)if("function"==typeof n.onFulfilled)try{e=n.onFulfilled.call(void 0,o),t.resolve(e)}catch(f){t.reject(f)}else t.resolve(o);if("rejected"===i)if("function"==typeof n.onRejected)try{e=n.onRejected.call(void 0,o),t.resolve(e)}catch(c){t.reject(c)}else t.reject(o)}},l=function(e){if("pending"!=i)return void u();if(t===e)throw new TypeError("Promise cannot be resolved with itself as result.");if(f(e))"pending"!=e.state().state?(c(e.state().state,e.state().result),u()):e.then(function(e){t.resolve(e)},function(e){t.reject(e)});else if("function"==typeof e){var n=function(e){c("fulfilled",e),u()},o=function(e){c("rejected",e),u()};try{e.call(e,n,o)}catch(r){c("rejected",r)}}else c("fulfilled",e);u()};t.then=function(n,t){var o=new e("INSIDE PROMISE2");return r.push({onFulfilled:n,onRejected:t,promise2:o}),"pending"!=i&&window.setTimeout(function(){u()},0),o},t["catch"]=function(n){var t=new e;return r.push({onFulfilled:void 0,onRejected:n,promise2:t}),"pending"!=i&&window.setTimeout(function(){u()},0),t},t["finally"]=function(n){var t=new e;return r.push({onFulfilled:n,onRejected:n,promise2:t}),"pending"!=i&&window.setTimeout(function(){u()},0),t},"function"==typeof n&&setTimeout(function(){l(n)},0)};return e.when=function(n){return new e(function(e,t){for(var i=[],o=n.length,r=0;r<n.length;r++){var f=function(n,t){i[this.idx]=n,o--,0==o&&e(i)};f=f.bind({idx:r}),n[r].then(f)["catch"](function(e){t(e)})}})},e.resolve=function(n){return(new e).resolve(n)},e.reject=function(n){return(new e).reject(n)},e.all=e.when,e.race=function(n){return new e(function(e,t){for(var i=0;i<n.length;i++)n[i].then(function(n){e(n)})["catch"](function(e){t(e)})})},e});