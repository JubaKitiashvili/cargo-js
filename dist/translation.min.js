!function(n,e){"function"==typeof define&&define.amd?define(["superagent","underscore"],e):"object"==typeof exports?module.exports=e(require("superagent"),require("underscore")):(n.cargo=n.cargo||{},n.cargo.Translation=e(n.superagent,n.underscore))}(this,function(n,e){var a=function(a){"use strict";if(!Promise)throw new Error("Promise API is required.");if(!Promise.all)throw new Error("Promise API with support for Promise.all() is required. (https://github.com/tildeio/rsvp.js/)");if(!n)throw new Error("superagent is required. (https://github.com/visionmedia/superagent)");if(!e)throw new Error("underscore is required. (https://github.com/jashkenas/underscore)");var r={};a=a||{};var t=a.baseURI;if(!t){var i=""+document.location,s=i.indexOf("#");s!=-1&&(i=i.substring(0,s)),i.match(/\.html/)&&(s=i.lastIndexOf("/"),s!=-1&&(i=i.substring(0,s+1))),t=i+"locales"}t=t.replace(/\/+$/,""),r.baseURI=t,r.namespaces=a.namespaces||(a.defaultNamespace?[a.defaultNamespace]:["translation"]),r.defaultLang=a.defaultLang||"en",r.lang=r.defaultLang,r.caching=a.caching||!0;var o=function(n,e){return!e||r.namespaces.length<=1?n:e+"."+n},u={},c=function(n,e,a){if(r.caching){u[n]=u[n]||{},u[n][e]=a}},f=function(n){var e=new RegExp("(.+)_.+"),a=e.exec(n);return a?a[1]:void 0},l=function(e,a){if(u[e]&&u[e][a])return new Promise(function(n){n({lang:e,namespace:a,translation:u[e][a]})});var r=t+"/"+e+"/"+a+".json";return new Promise(function(t){n.get(r).end(function(n,r){return r&&r.ok?(c(e,a,r.body),void t({lang:e,namespace:a,translation:r.body})):void t({lang:e,namespace:a,translation:void 0})})})},d=function(n,a){var r=n.lang,t=f(r)||r,i=n.defaultLang,s=n.namespaces[0];return function(n,o){o=o||s;var u=e.chain([r,t,i]).uniq().reduce(function(e,r){return e||a[r]&&a[r][o]&&(e=a[r][o][n]),e},void 0).value();return u||n}},g=function(n){var a=n.lang,r=n.namespaces,t=e.uniq([a,f(a)||a,n.defaultLang]),i=[];e.each(t,function(n){e.each(r,function(e){i.push(l(n,e))})});var s=Promise.all(i).then(function(a){var r={};return e.each(a,function(n){r[n.lang]=r[n.lang]||{},r[n.lang][n.namespace]=n.translation,c(n.lang,n.namespace,n.translation)}),o=d(n,r),Promise.resolve(o)});return s["catch"](function(n){console.log(n&&n.stack?n.stack:n)}),s};this.setDefaultLanguage=function(n){return r.defaultLang=n,g(r)},this.setNamespace=function(n){var a=e.isArray(n)?n:[n];return r.namespaces=a,g(r)},this.addNamespace=function(n){return e.contains(r.namespaces,n)||r.namespaces.push(n),g(r)},this.select=function(n){return r.lang=n,g(r)},this.translate=function(n,e){return o(n,e)},this.i18n=function(){return o},this.createHandlebarsHelper=function(){var n=e.bind(function(){var n,e,a=this.i18n();switch(arguments.length){case 0:case 1:return"";case 2:n=arguments[0],e=r.namespaces[0];break;case 3:n=arguments[0],e=arguments[1]}return a(n,e)},this);return n._t=e.bind(function(){return this.i18n()},this),n}};return a});